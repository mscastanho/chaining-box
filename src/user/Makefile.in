# This is intended to be imported by other Makefiles
# which in turn will set their respective USER_TARGETS

BUILD_DIR = $(SRCDIR)build

CFLAGS += -I$(SRCDIR)utils -I$(SRCDIR)headers

LDFLAGS ?= -L$(BUILD_DIR)

LIBS = -lcbox -lbpf -lelf

all: bdir-check $(USER_TARGETS)

bdir-check:
	@if [ ! -d $(BUILD_DIR) ]; then \
		echo "Error: Directory $(BUILD_DIR) doesn't exist."; \
		echo "Create it first or run the top-level Makefile instead."; \
		exit 1; \
	fi

$(USER_TARGETS): %: %_user.c
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ $(UTILS) $(LIBS)
	@mv $@ $(BUILD_DIR)
